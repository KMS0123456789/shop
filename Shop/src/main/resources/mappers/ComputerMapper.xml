<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ComputerMapper">
	<resultMap type="com.project.shop.computer.vo.ComputerVO" id="computerMap">
		<id property="computerNo" column="computer_no"/>
		<result property="computerTitle" column="computer_title"/>
		<result property="computerBody" column="computer_body"/>
		<result property="computerSalePrice" column="computer_sale_price"/>
		<result property="cpu" column="cpu"/>
		<result property="ssd" column="ssd"/>
		<result property="mainBoard" column="main_board"/>
		<result property="gpu" column="gpu"/>
		<result property="power" column="power"/>
		<result property="bCase" column="b_case"/>
		<result property="ram" column="ram"/>
		<result property="cooler" column="cooler"/>
		<result property="computerStock" column="computer_stock"/>
		<result property="computerOutFlag" column="computer_out_flag"/>
		<result property="computerSaleDate" column="computer_sale_date"/>
		<result property="computerCreateDate" column="computer_create_date"/>
		<result property="mainFlag" column="main_flag"/>
		<collection property="reviews" ofType="com.project.shop.user.vo.ReviewVO">
			<id property="reviewNo" column="review_no"/>
			<result property="reviewUser" column="review_user"/>
			<result property="computerNo" column="computer_no"/>
			<result property="peripheralNo" column="peripheral_no"/>
			<result property="reviewBody" column="review_body"/>
			<result property="reviewCreateDate" column="review_create_date"/>
			<result property="itemCategory" column="item_category"/>
		</collection>
		<collection property="questions" ofType="com.project.shop.user.vo.QuestionVO">
			<id property="questionNo" column="question_no"/>
			<result property="questionUser" column="question_user"/>
			<result property="computerNo" column="computer_no"/>
			<result property="peripheralNo" column="peripheral_no"/>
			<result property="questionTitle" column="question_title"/>
			<result property="questionBody" column="question_body"/>
			<result property="questionCreateDate" column="question_create_date"/>
			<result property="questionFlag" column="question_flag"/>
			<result property="itemCategory" column="item_category"/>
		</collection>
		<collection property="answers" ofType="com.project.shop.user.vo.AnswerVO">
			<id property="questionNo" column="question_no"/>
			<result property="answerBody" column="answer_body"/>
			<result property="answerDate" column="answer_date"/>
		</collection>
		<collection property="peripherals" ofType="com.project.shop.computer.vo.PeripheralVO">
			<id property="peripheralNo" column="peripheral_no"/>
			<result property="peripheralCategory" column="peripheral_category"/>
			<result property="peripheralTitle" column="peripheral_title"/>
			<result property="peripheralBody" column="peripheral_body"/>
			<result property="peripheralName" column="peripheral_name"/>
			<result property="peripheralStock" column="peripheral_stock"/>
			<result property="peripheralSalePrice" column="peripheral_sale_price"/>
			<result property="peripheralOutFlag" column="peripheral_out_flag"/>
			<result property="peripheralSaleDate" column="peripheral_sale_date"/>
			<result property="peripheralCreateDate" column="peripheral_create_date"/>
		</collection>
	</resultMap>
	
	<!-- 완제품 전체 조회 -->
	<select id="computer" resultMap="computerMap">
		select * from computer
		<!-- where 태그 쓸 때는 where가 있다 생각하고 and부터 쓴다 -->
		<where>
			<if test="searchType != null and searchType != '' and keyword != null and keyword != ''">
				and ${searchType} like concat('%',#{keyword},'%')
			</if>
		</where>
		order by computer_no desc
		limit #{offset}, #{limit}
	</select>
	
	<!-- 완제품 전체 개수 조회 -->
	<select id="count" resultType="int">
		select count(*) from computer
		<where>
			<if test="searchType != null and searchType != '' and keyword != null and keyword != ''">
				and ${searchType} like concat('%',#{keyword},'%')
			</if>
		</where>
	</select>
	
	<!-- 완제품 단건 조회 -->
	<select id="computerPost" parameterType="int" resultMap="computerMap">
		select * 
		from computer 
		left join review on computer.computer_no = review.computer_no
		left join question on computer.computer_no = question.computer_no
		left join answer on question.question_no = answer.question_no
		where computer.computer_no = #{computerNo}	
	</select>
	
	<!-- 메인 페이지를 위한 완제품 조회 -->
	<select id="home" resultMap="computerMap">
		select * from computer  order by computer_no desc limit 0, 5
	</select>
</mapper>